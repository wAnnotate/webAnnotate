{% extends "main.html" %}
{% block content %}
<script defer>
    function toNormalDataTable() {
        $("#table").dataTable({
             
        dom: 'lBfrtip',
             "orderable": false,
             
            buttons: [
            {
                extend: 'csv',
                exportOptions: {
                    columns: [ 1, 2, 3, 4,5,6,7,8,9,10,11,12,13 ]
                }
            },
            
            {
                extend: 'excel',
                exportOptions: {
                    columns: [ 1, 2, 3, 4,5,6,7,8,9,10,11,12,13 ]
                }
            },
            
            {
                extend: 'print',
                exportOptions: {
                    columns: [ 1, 2, 3, 4,5,6,7,8,9,10,11,12,13 ]
                }
            }
            ],
             "columnDefs": [
                 {
                     "targets": [11,12],
                     "class":"none"
                 },
                 {
                     "orderable": false,
                     "aaSorting": false,
                     "targets": "_all",
                 },
                 {
                    "targets": [0],
                    "className": 'details-control',
                }
             ],
             
             "iDisplayLength": 2,
             "aLengthMenu": [[2,5, 10, 25, 50, 100, -1], [2,5, 10, 25, 50, 100, "All"]],
             "language": {
                 "paginate": {
                     "previous": "previous",
                     "next": "next"
                 }
             },
			 responsive: true,
             initComplete: function () {
                 this
                    .api().order( [ 1, 'asc' ] )
                    .draw();
                 [...document.getElementsByTagName("button")]
                    .filter(b => b.getAttribute("name") != "+")
                    .forEach(b => b.className += " btn btn-outline-primary");
                 let count = 0;
                 let cols = [4,5,6,9]; 
                 this.api().columns(cols).every(function () {
                     var column = this;
                     var select = $(`<select id="select${count}"><option value=""></option></select>`)
                         .appendTo($("#s"+String(count++)))
                         .on('change', function () {
                             var val = $.fn.dataTable.util.escapeRegex($(this).val());
                             column.search(val ? '^' + val + '$' : '', true, false).draw();
                         });
                     column.data().unique().sort().each(d => {
                            select.append('<option value="' + d + '">' + d + '</option>');
                     });
                 });
             }
         })

    }
    setTimeout(()=>toNormalDataTable(),2000);
    function toggleFilter(){
        let filterB = document.getElementById("fltr");
        if(filterB.innerText.includes(">")){
            document.getElementById("filter").style.display = "block";
            filterB.innerText = "Filter V";
        }
        else{
            document.getElementById("filter").style.display = "none";
            filterB.innerText = "Filter >";
        }
    }
    function toggle(btn){
        if(btn.innerText == "-") btn.innerText = "+";
        else btn.innerText = "-";
    }

    window.addEventListener("load",() => {
        var span = document.getElementsByClassName("close")[0];
        var modal = document.getElementById("myModal");
        span.onclick = function() {
            modal.style.display = "none";
            [...document.getElementsByTagName("select")]
                .forEach(select => select.selectedIndex = 0);
        }
        window.onclick = event => {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    })

    function toggleModal(select){
        if(!select.value)
            return;
        var gene = select.value.split("-")[0]
        var index = select.value.split("-")[1]
        var type = select.value.split("-")[2]
        var modal = document.getElementById("myModal");
        var modalHeader = document.getElementById("modalHeader");
        var modalBody = document.getElementById("modalBody");
        fetch(`/getVariantData?gene=${gene}&variant=${index}&type=${type}`)
            .then(data => data.json())
            .then(data => {
                modalHeader.innerText = data["header"];
                modalBody.innerHTML = data["body"];
                modal.style.display = "block";
            })
    }
</script>
<div id="myModal" class="modal"  style="display: none;">
    <div class="modal-content" id="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h2 id="modalHeader">Modal Header</h2>
        </div>
        <div class="modal-body" id="modalBody">
        </div>
    </div>
</div>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th colspan="2">
                        <a href="javascript:toggleFilter()" id="fltr">
                            Filter >
                        </a>
                    </th>
                </tr>
            </thead>
            <tbody id="filter" style="display: none;">
                <tr>
                    <td>Gene Name</td>
                    <td id="s0"></td>
                </tr>
                <tr>
                    <td>Biotype</td>
                    <td id="s1"></td>
                </tr>
                <tr>
                    <td>Contig</td>
                    <td id="s2"></td>
                </tr>
                <tr>
                    <td>Strand</td>
                    <td id="s3"></td>
                </tr>
            </tbody>
        </table>
        {{table|safe}}
{% endblock %}btn btn-outline-primary